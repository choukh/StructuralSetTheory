#! https://zhuanlan.zhihu.com/p/551448520
# Coqç»“æ„åŒ–é›†åˆè®º(1): é¢„å¤‡çŸ¥è¯†

> Qç¾¤ï¼š893531731  
> GitHub: [choukh/StructuralSetTheory](https://github.com/choukh/StructuralSetTheory)  

### å‰ç½®è¦æ±‚

- ç†Ÿæ‚‰ Coq (å¯çœ‹[SFç¬¬1å·](https://coq-zh.github.io/SF-zh/lf-current/toc.html))
- ç†Ÿæ‚‰ä»»æ„ä¸€ç§é›†åˆè®º (å¯çœ‹[å¦‚ä½•ç”¨Coqå½¢å¼åŒ–é›†åˆè®º](https://zhuanlan.zhihu.com/p/415778984)).

### æ€»ç›®å½•
- Coqç»“æ„åŒ–é›†åˆè®º(1): é¢„å¤‡çŸ¥è¯†
- [Coqç»“æ„åŒ–é›†åˆè®º(2): åºæ•°](https://zhuanlan.zhihu.com/p/551647120)
- Coqç»“æ„åŒ–é›†åˆè®º(3): è‰¯åºé›†å‰æ®µ (TODO)

## å¼•è¨€

æ‰€è°“[ç»“æ„åŒ–é›†åˆè®º](https://ncatlab.org/nlab/show/structural+set+theory), ç®€å•æ¥è¯´å°±æ˜¯ä¸ä»¥æˆå‘˜å…³ç³» âˆˆ è€Œä»¥å‡½æ•°ç®­å¤´ â†’ ä¸ºåŸå§‹æ¦‚å¿µçš„é›†åˆè®º. æœ€å¸¸è§çš„ä¸€ç§æ˜¯ [ETCS](https://ncatlab.org/nlab/show/ETCS) (Elementary theory of the category of sets). å®ƒæ˜¯ä¸€ç§èŒƒç•´è®ºé£å‘³çš„é›†åˆè®º, ä½†å®ƒæœ¬èº«ä¸å¿…ç„¶è¦å»ºç«‹åœ¨èŒƒç•´è®ºä¹‹ä¸Š. éå½¢å¼åœ°, æ® [Leinster](https://arxiv.org/pdf/1212.6543.pdf), ETCS å¯ä»¥è¡¨è¿°å¦‚ä¸‹ 

1. å‡½æ•°çš„å¤åˆæ»¡è¶³ç»“åˆå¾‹, ä¸”å­˜åœ¨æ’ç­‰å‡½æ•° **(èŒƒç•´)**
2. å­˜åœ¨åªæœ‰ä¸€ä¸ªå…ƒç´ çš„é›†åˆ **(å•é›†)**
3. å­˜åœ¨æ²¡æœ‰å…ƒç´ çš„é›†åˆ **(ç©ºé›†)**
4. å‡½æ•°ç”±å…¶å¯¹å…ƒç´ çš„ä½œç”¨æ‰€å”¯ä¸€å†³å®š **(å¤–å»¶æ€§)**
5. ç»™å®šé›†åˆ A B, å­˜åœ¨**ç¬›å¡å°”ç§¯** A Ã— B
6. ç»™å®šé›†åˆ A B, å­˜åœ¨å®ƒä»¬ä¹‹é—´çš„**å‡½æ•°ç©ºé—´** A â†’ B
7. ç»™å®š f : A â†’ B ä»¥åŠ y âˆˆ B, å­˜åœ¨ y çš„**é€†åƒ** fâ»Â¹(y)
8. A çš„å­é›†å¯¹åº”äº A åˆ° {0, 1} çš„å‡½æ•° **(å­å¯¹è±¡åˆ†ç±»å™¨)**
9. å­˜åœ¨è‡ªç„¶æ•°é›† **(â„•)**
10. æ»¡å°„éƒ½æœ‰å³é€† **(é€‰æ‹©)**

ç±»ä¼¼è¿™ç§å½¢å¼çš„ç†è®ºå¯ä»¥è¯´æ˜¯æ•°å­¦å®¶æ—¥å¸¸çœŸæ­£ä½¿ç”¨çš„æ•°å­¦åŸºç¡€. è™½ç„¶åˆçœ‹èµ·æ¥è·Ÿ ZFC å¾ˆä¸ä¸€æ ·, ä½†å®é™…ä¸Š, ETCS åŠ ä¸Šæ›¿ä»£å…¬ç†å°±ç­‰ä»·äº ZFC, [Leinster ç¬¬7é¡µ](https://arxiv.org/pdf/1212.6543.pdf) ç»™å‡ºäº†ç›¸å…³æ–‡çŒ®.

æœ¬ç³»åˆ—æ–‡ç« å°†å±•ç¤ºå¦‚ä½•åœ¨ Coq ä¸Šå»ºç«‹ç»“æ„åŒ–é›†åˆè®º, æ›´å‡†ç¡®åœ°è¯´æ˜¯å°† Coq è§£é‡Šä¸ºæŸç§ç»“æ„åŒ–é›†åˆè®º. å› ä¸ºåœ¨ Coq ä¸­, ä¸Šè¿° 10 é¡¹ä¸­çš„ 1, 6 æ˜¾ç„¶æˆç«‹, 2, 3, 5, 9 éƒ½ç”±å½’çº³ç±»å‹ç»™å‡º, 7, 8 ç”± Sigma ç±»å‹ç»™å‡º, åªæœ‰ 4 å’Œ 10 éœ€è¦å¼•å…¥é¢å¤–çš„å…¬ç†. æˆ‘ä»¬çš„ç›®çš„æ˜¯, ä»¥è¿™ç§ç»“æ„åŒ–é›†åˆè®ºè§£é‡Šä½œä¸ºè·³æ¿, æ¢è®¨ä¼ ç»Ÿé›†åˆè®ºä¸­å¦‚åºæ•°å’ŒåŸºæ•°ç­‰æ¦‚å¿µçš„åœ¨ç±»å‹è®ºä¸­ç›¸å¯¹åŸç”Ÿçš„è¡¨ç¤º. è¿™æ ·åšçš„ä¸€ä¸ªå¥½å¤„æ˜¯, ç›¸è¾ƒäºä¹‹å‰çš„ç³»åˆ—æ–‡ç«  [å¦‚ä½•ç”¨Coqå½¢å¼åŒ–é›†åˆè®º](https://zhuanlan.zhihu.com/p/415778984) ä»‹ç»çš„æ‰€è°“æµ…ç¼–ç æ³• (shallow encoding), é¢„è®¡å¯ä»¥å‡å°‘ä¸‰åˆ†ä¹‹ä¸€çš„ä»£ç é‡, å› ä¸ºæˆ‘ä»¬è¿™é‡Œæ²¡æœ‰ encoding, åªæœ‰è½»é‡çš„ notation.

## å…¬ç†

æˆ‘ä»¬éœ€è¦ 2 æ¡å…¬ç†, åˆ†åˆ«æ˜¯å‘½é¢˜çš„å¤–å»¶æ€§ (PE) å’Œå‡½æ•°çš„å¤–å»¶æ€§ (FE). ç”±äºæˆ‘ä»¬è®¡åˆ’åæ¨æ•°å­¦å¼åœ°è€ƒå¯Ÿæ’ä¸­å¾‹å’Œé€‰æ‹©å…¬ç†, åœ¨æ­¤ä¸åˆ—ä½œå…¬ç†.

```Coq
(* å‘½é¢˜å¤–å»¶ *)
Axiom PE : âˆ€ P Q, P â†” Q â†’ P = Q.
(* å‡½æ•°å¤–å»¶ *)
Axiom FE : âˆ€ A B (f g : A â†’ B), (âˆ€ x, f x = g x) â†’ f = g.
```

ç”± PE å’Œ FE å¯ä»¥ç«‹å³è¯æ˜è°“è¯çš„å¤–å»¶æ€§.

```Coq
Lemma è°“è¯å¤–å»¶ A (p q : A â†’ Prop) : (âˆ€ x, p x â†” q x) â†’ p = q.
Proof. intros H. apply FE. intros x. apply PE, H. Qed.
```

æ­¤å¤–, ç”± PE è¿˜å¯ä»¥å¾—åˆ°è¯æ˜æ— å…³æ€§ (proof irrelevance). å› ä¸ºç”± PE, P â†” True è•´å« P = True, ç”±æ­¤æ”¹å†™ H H' : P, å¾—åˆ° H H' : True, æ‰€ä»¥ H å’Œ H' éƒ½ç­‰äº I : True.

```Coq
(* è¯æ˜æ— å…³æ€§ *)
Fact PI (P : Prop) (H H' : P) : H = H'.
Proof.
  enough (P = True) as ->.
  destruct H, H'. reflexivity. apply PE. easy.
Qed.
```

## åŸºæœ¬éƒ¨ä»¶

æŒ‰ä¼ ç»Ÿ, æˆ‘ä»¬å…ˆå¤„ç† âˆˆ å’Œ âŠ†. å¹¶éæ‰€æœ‰å¯¹è±¡ä¹‹é—´éƒ½å¯ä»¥è°ˆè®º âˆˆ å’Œ âŠ† å…³ç³», è¿™æ˜¯ç»“æ„åŒ–é›†åˆè®ºçš„ä¸€å¤§ç‰¹å¾. å¯¹äºé‚£äº›ä¸èƒ½ç”¨ âˆˆ å’Œ âŠ† è¿æ¥èµ·æ¥çš„å†™æ³•, å°†è¢«ç±»å‹æ£€æŸ¥å™¨ç¦æ­¢.

æŸè°“è¯ p : A â†’ Prop å¯¹ x : A çš„åº”ç”¨ p x å¯ä»¥è§£é‡Šä¸º**æˆå‘˜å…³ç³»**, è®°ä½œ x âˆˆ p, å¯¹æ­¤æˆ‘ä»¬åªå®šä¹‰éå¸¸è½»é‡çš„è®°æ³• (only parsing), å°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥å†™ x âˆˆ p, ä½† Coq è¿˜æ˜¯æ˜¾ç¤ºä¸º p x.

```Coq
Notation "x âˆˆ p" := (p x) (only parsing, at level 70).
```

å½“ç„¶, x : A ä¹Ÿå¯ä»¥è§£é‡Šä¸º x âˆˆ A, è€Œ p : A â†’ Prop ä¹Ÿå¯ä»¥è§£é‡Šä¸º p âŠ† A, ä½†æˆ‘ä»¬çš„åŸåˆ™æ˜¯ä¸å¯¹ç±»å‹æ ‡è®° ":" å®šä¹‰ä»»ä½•å…¶ä»–è®°æ³•. å¦å¤–, æˆ‘ä»¬æŠŠ (âˆ€ x, x âˆˆ A â†’ P x) è®°ä½œ (âˆ€ x âˆˆ A, P x); æŠŠ (âˆƒ x, x âˆˆ A âˆ§ P x) è®°ä½œ (âˆƒ x .. y âˆˆ A , P x), è¿™é‡Œä¸ä¸€ä¸€è´´å‡ºä»£ç .

æˆ‘ä»¬å°† A çš„è°“è¯ p : A â†’ Prop è§†ä½œ A çš„**å­é›†**, é‚£ä¹ˆ A çš„**å¹‚é›†**å°±æ˜¯ A çš„æ‰€æœ‰è°“è¯æ‰€ç»„æˆçš„é›†åˆ A â†’ Prop. ç”±äºçŸ¥ä¹ä¸æ”¯æŒåœ¨ä»£ç å—ä¸­æ˜¾ç¤ºå¹‚é›†ç¬¦å· $\mathcal{P}$, åœ¨ä»£ç å—ä¸­æˆ‘ä»¬å°±ç”¨æ±‰å­—"å¹‚".

```Coq
Notation "'å¹‚' A" := (A â†’ Prop) (at level 9).
```

å­é›† p q : $\mathcal{P}$ A çš„è•´å«å…³ç³»å¯ä»¥è§£é‡Šä¸º**åŒ…å«å…³ç³»**.

```Coq
Definition åŒ…å« A (p q : ğ’« A) := âˆ€ x âˆˆ p, x âˆˆ q.
Notation "p âŠ† q" := (åŒ…å« p q) (at level 70).
Notation "p âŠ‚ q" := (p âŠ† q âˆ§ q âŠˆ p) (at level 70).
```

å¯ä»¥è¯æ˜åŒ…å«å…³ç³»æ»¡è¶³è‡ªåæ€§å’Œä¼ é€’æ€§.

```Coq
Fact åŒ…å«_è‡ªå A (p : å¹‚ A) : p âŠ† p.
Proof. firstorder. Qed.

Fact åŒ…å«_ä¼ é€’ A (p q r : å¹‚ A) : p âŠ† q â†’ q âŠ† r â†’ p âŠ† r.
Proof. firstorder. Qed.
```

è€ŒåŒ…å«å…³ç³»çš„åå¯¹ç§°æ€§å…¶å®å°±æ˜¯é›†è®ºå¤–å»¶, å®ƒç”±è°“è¯å¤–å»¶ç»™å‡º.

```Coq
(* é›†è®ºå¤–å»¶ *)
Lemma åŒ…å«_åå¯¹ç§° A (p q : å¹‚ A) : p âŠ† q â†’ q âŠ† p â†’ p = q.
Proof. intros. apply è°“è¯å¤–å»¶; firstorder. Qed.
Notation å¤–å»¶ := åŒ…å«_åå¯¹ç§°.
```

æˆ‘ä»¬è¿˜å®šä¹‰äº†éç©º, äºŒå…ƒå¹¶, äºŒå…ƒäº¤, è¡¥é›†, å•é›†, é…å¯¹, åˆ†ç¦»ç­‰çš„è®°æ³•.

```Coq
Notation "A â‰  âˆ…" := (âˆƒ x, x âˆˆ A) (only parsing, at level 70).
Notation "A â‹ƒ B" := (Î» x, x âˆˆ A âˆ¨ x âˆˆ B) (at level 60).
Notation "A âˆ© B" := (Î» x, x âˆˆ A âˆ§ x âˆˆ B) (at level 60).
Notation "A â»" := (Î» x, Â¬ x âˆˆ A) (format "A â»", at level 20).
Notation "{ a , }" := (Î» x, x = a) (only parsing).
Notation "{ a , b }" := (Î» x, x = a âˆ¨ x = b) (only parsing).
Notation "{ x âˆŠ A | P }" := (Î» x, x âˆˆ A âˆ§ P) (only parsing).
Notation "{ x âˆŠ A | xA 'in' P }" := (Î» x, âˆƒ xA : x âˆˆ A, P) (only parsing).
```

å…¶ä¸­æœ€åä¸€é¡¹çš„ xA æ˜¯ x âˆˆ A çš„è¯æ®, æœ‰æ—¶éœ€è¦åœ¨åˆ†ç¦»æ¡ä»¶ P ä¸­ç”¨åˆ°, æ‰€ä»¥æ˜¾å¼ç»™å‡º.

## å­ç±»å‹

å¯¹ [Sigma](https://coq.inria.fr/library/Coq.Init.Specif.html) ç±»å‹æˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹å•å­—æ¯è®°æ³•.

```Coq
Notation Î£ := sig.
Notation Ïƒ := exist.
Notation Ï€â‚ := proj1_sig.
Notation Ï€â‚‚ := proj2_sig.
```

PI ä½¿å¾— Sigma ç±»å‹å…·æœ‰è‰¯å¥½çš„æ€§è´¨ (ä¸‹æ–‡çš„ Ïƒ-å‡½æ•°æ€§å’Œ Ï€-å•å°„æ€§), æˆ‘ä»¬æ”¹ç§°å…¶ä¸ºå­ç±»å‹. å…·ä½“åœ°, å­ç±»å‹ Î£ p å°±æ˜¯å­é›† p : $\mathcal{P}$ A çš„ç±»å‹åŒ–. ç»™å®š x : A å’Œ px : x âˆˆ p, æœ‰ Ïƒ A x px : Î£ p. ç»™å®š xâ‚› : Î£ p, æœ‰ Ï€â‚ xâ‚› : A ä¸” Ï€â‚‚ xâ‚› : x âˆˆ p. ä¸ºæé«˜å¯è¯»æ€§, æˆ‘ä»¬çº¦å®š, å¯¹è¡¨ç¤ºå­ç±»å‹çš„é¡¹çš„å˜é‡, ä¸€å¾‹åŠ sä¸‹æ ‡.

ç”¨ PI å¯ä»¥ç«‹å³è¯æ˜ Ïƒ å…·æœ‰å‡½æ•°æ€§, Ï€â‚ å…·æœ‰å•å°„æ€§; ç”±å®šä¹‰ Ïƒ å’Œ Ï€â‚, Ï€â‚‚ æ»¡è¶³ Î·-å˜æ¢.

```Coq
Fact Ïƒ_å‡½æ•° A (p : å¹‚ A) x y px py : x = y â†’ Ïƒ p x px = Ïƒ p y py.
Proof. intros ->. now rewrite (PI px py). Qed.

Lemma Ï€_å•å°„ A (p : å¹‚ A) (xâ‚› yâ‚› : Î£ p) : Ï€â‚ xâ‚› = Ï€â‚ yâ‚› â†’ xâ‚› = yâ‚›.
Proof. destruct xâ‚› as [x px], yâ‚› as [y py]. apply Ïƒ_å‡½æ•°. Qed.

Lemma ÏƒÏ€_Î· A (p : å¹‚ A) (xâ‚› : Î£ p) : Ïƒ p (Ï€â‚ xâ‚›) (Ï€â‚‚ xâ‚›) = xâ‚›.
Proof. now destruct xâ‚›. Qed.
```

## å•å°„

å•å°„éµç…§é€šå¸¸çš„å®šä¹‰, åªæ˜¯æˆ‘ä»¬é‡‡ç”¨äº†åŸºæ•°å°äºç­‰äºçš„è®°æ³•. å³ä½¿æˆ‘ä»¬æ²¡å®šä¹‰åŸºæ•°, ä½†ä¸å¦¨ç¢æˆ‘ä»¬ç›´æ¥ä½¿ç”¨æ­¤è®°æ³•, å°±åƒä¸Šæ–‡çš„å…¶ä»–é›†åˆè®ºæ¦‚å¿µä¸€æ ·.

```Coq
Definition å•å°„æ€§ A B (f : A â†’ B) := âˆ€ x y, f x = f y â†’ x = y.
Definition å•å°„ A B := âˆƒ f : A â†’ B, å•å°„æ€§ f.
Notation "| A | â‰¤ | B |" := (å•å°„ A B) (format "| A |  â‰¤  | B |", at level 70).
```

å•å°„å…³ç³»æ˜¯é¢„åº: æ’ç­‰å‡½æ•°ç»™å‡ºäº†è‡ªåæ€§, å‡½æ•°å¤åˆç»™å‡ºäº†ä¼ é€’æ€§.

```Coq
Global Instance å•å°„_é¢„åº : PreOrder å•å°„.
Proof. split.
  - intros A. exists (Î» x, x). firstorder.
  - intros A B C [f Hf] [g Hg]. exists (Î» x, g (f x)). firstorder.
Qed.
```

A çš„ä»»æ„å­ç±»å‹å¯ä»¥å•å°„åˆ° A, å› ä¸º Ï€â‚ å°±æ˜¯è¿™æ ·çš„å•å°„.

```Coq
Lemma å•å°„_ä»å­é›† A (p : å¹‚ A) : |Î£ p| â‰¤ |A|.
Proof. exists (@Ï€â‚ A p). intros x y. apply Ï€_å•å°„. Qed.
```

A å¯ä»¥å•å°„åˆ° $\mathcal{P}$ A, å› ä¸º eq : A â†’ $\mathcal{P}$ A å°±æ˜¯è¿™æ ·çš„å•å°„.

```Coq
Lemma å•å°„_åˆ°å¹‚é›† A : |A| â‰¤ |å¹‚ A|.
Proof. exists eq. now intros x y ->. Qed.
```

ç”¨å•å°„çš„æ¦‚å¿µå¯ä»¥å°†æ— ç©·é›†å®šä¹‰ä¸ºè¢« nat å•å°„çš„é›†åˆ.

```Coq
Definition æ— ç©· A := |nat| â‰¤ |A|.
```

å…‰é ä»¥ä¸Šæ¦‚å¿µæˆ‘ä»¬ç”šè‡³å¯ä»¥è¡¨è¾¾å¹¿ä¹‰è¿ç»­ç»Ÿå‡è®¾. ç”±æ­¤å¯è§åœ¨ç»“æ„åŒ–é›†åˆè®ºä¸­é¢å¤–å¼€é”€éå¸¸å°‘.

```Coq
(* å¹¿ä¹‰è¿ç»­ç»Ÿå‡è®¾ *)
Definition GCH := âˆ€ A B, æ— ç©· A â†’ |A| â‰¤ |B| â†’ |B| â‰¤ |å¹‚ A| â†’ |B| â‰¤ |A| âˆ¨ |å¹‚ A| â‰¤ |B|.
```

## åŒå°„

å¯¹åŒå°„æˆ‘ä»¬é‡‡ç”¨å­˜åœ¨äº’é€†å‡½æ•°çš„å®šä¹‰, å› ä¸ºé€šå¸¸çš„å•å°„åŠ æ»¡å°„çš„å®šä¹‰åœ¨ Coq ä¸­ç¼ºå°‘å”¯ä¸€é€‰æ‹©å…¬ç†çš„æƒ…å†µä¸‹å¼±äºäº’é€†çš„å®šä¹‰.

```Coq
Definition äº’é€† A B (f : A â†’ B) (g : B â†’ A) := (âˆ€ x, f (g x) = x) âˆ§ (âˆ€ y, g (f y) = y).
Definition åŒå°„ A B := âˆƒ (f : A â†’ B) (g : B â†’ A), äº’é€† f g.
Notation "| A | = | B |" := (åŒå°„ A B) (format "| A |  =  | B |", at level 70).
```

åŒå°„æ˜¯ç­‰ä»·å…³ç³», è¯æ˜ä¸å•å°„é¢„åºçš„è¯æ˜ç±»ä¼¼, ç”±æ’ç­‰å‡½æ•°, å‡½æ•°å¤åˆç­‰å¾—åˆ°.

```Coq
Global Instance åŒå°„_ç­‰ä»·å…³ç³» : Equivalence åŒå°„.
Proof. split.
  - intros A. exists (Î» x, x), (Î» x, x). firstorder.
  - intros A B (f & g & inv). exists g, f. firstorder.
  - intros A B C (f & g & fg & gf) (h & i & hi & ih).
    exists (Î» x, h (f x)), (Î» x, g (i x)). firstorder congruence.
Qed.
```

åŒå°„è•´å«å•å°„.

```Coq
Fact åŒå°„_å•å°„ A B : |A| = |B| â†’ |A| â‰¤ |B|.
Proof. intros (f & g & fg & gf). exists f. congruence. Qed.
```
